<!DOCTYPE html>
<html lang="en">

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="Lake">
  <meta name="author" content="GeniusOcean">
  <title>Lake of Cakes | Login</title>

  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->

  <!-- New Navbar Link -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="mega-menu.css">
  <link rel="icon" type="image/x-icon" href="//lakeofcakes.com/assets/images/1596886304logo for favicon.PNG" />


  <meta name="theme-color" content="#a15a55">
  <link href="../assets/css/login.css" rel="stylesheet" type="text/css" media="screen" />

  <link type="text/css" rel="stylesheet" href="firebaseui.css" />

  <link rel="manifest" href="manifest.json">


</head>

<body style="overflow-x: hidden !important; ">


  <section class="w3l-workinghny-form">
    <!-- /form -->
    <div class="workinghny-form-grid">
      <div class="wrapper">
        <div class="logo">
          <!-- <h1><a class="brand-logo" href="index.html"><span>Hi !!</span>Guest</a></h1> -->
          <img src="../assets/images/logo.png" alt="" style="width: 400px;object-fit: contain;">
          <!-- if logo is image enable this   
                        <a class="brand-logo" href="#index.html">
                            <img src="image-path" alt="Your logo" title="Your logo" style="height:35px;" />
                        </a> -->
        </div>
        <div class="workinghny-block-grid">

          <div class="workinghny-left-img ">

            <div id="loading">Loading...</div>
            <div id="loaded" class="hidden">
              <div id="main">
                <div id="user-signed-in" class="hidden">
                  <div id="user-info" style="display: none
                              ;">
                    <div id="photo-container">
                      <img id="photo">
                    </div>
                    <div id="name"></div>
                    <div id="email"></div>
                    <div id="phone"></div>
                    <div id="is-new-user"></div>
                    <div class="clearfix"></div>
                  </div>
                  <p>
                    <button id="sign-out" style="display: none;">Sign Out</button>
                    <button id="delete-account" style="display: none;">Delete account</button>
                  </p>
                </div>
                <div id="user-signed-out" class="hidden">

                  <fieldset>

                    <div id="firebaseui-spa">
                      <!-- <h5>Single Page Application mode:</h5> -->
                      <div id="firebaseui-container"></div>
                    </div>
                </div>
              </div>
            </div>


          </div>
          <div class="form-right-inf">

            <div class="login-form-content">
              <h2 style="text-align: center;padding: 10px !important;">Login</h2>

              <div class="one-frm">

                <label>Email</label>
                <input type="email" name="Name" id="email2" placeholder="" required="">
              </div>
              <div class="one-frm">
                <label>Password</label>
                <input type="password" name="Password" id="password" placeholder="" required="">
              </div>
              <!-- <label class="check-remaind">
                                    <input type="checkbox">
                                    <span class="checkmark"></span>
                                    <p class="remember">Remember Me</p>

                                </label> -->
              <button class="btn btn-style mt-3" id="log">Sign In </button>
              <p class="already">Don't have an account? <a href="signup.html">Sign Up</a></p>
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="bottomtotop">
        <i class="fas fa-chevron-right"></i>
      </div> -->
</body>
<script src="https://www.gstatic.com/firebasejs/7.4.0/firebase.js"></script>
<script src="config.js"></script>
<script src="common.js"></script>
<script src="firebaseui.js"></script>
<script src="app.js"></script>
<script>
  const dbs = firebase.firestore();
  dbs.collection("Customers").onSnapshot((snapshot) => {

    let snapshotDocs = snapshot.docs;
    document.getElementById("log").addEventListener("click", async function () {


      let email = document.querySelector('#email2').value;
      let password = document.querySelector('#password').value;
      var k;
      var count = 0;
      for (let i of snapshotDocs) {

        var doc = i.data();
        if(doc.Password==undefined){
          continue;
        }
        if ((doc.Email).toUpperCase() == email.toUpperCase() && atob(doc.Password) == password) {
          count++;
          key = i;
          break;

        }
      }
      if (count == 1) {
        document.getElementById("log").innerHTML = "Welcome Back" +" "+ key.data().UserName;
        document.getElementById("log").style.backgroundColor = "green"
        let token = btoa(key.data().id + "Online" + doc.Email)

        await dbs.collection("Customers").doc(key.data().userId).update("token", token)

        window.localStorage.setItem("locLoggedInUser", key.data().userId)

        setTimeout(function () {
          window.location = "/index.html";

        }, 100)


      } else {
        document.getElementById("log").innerHTML = "Invalid Credentials"
        document.getElementById("log").style.backgroundColor = 'red'
        setTimeout(function () {
          document.getElementById("log").innerHTML = "Login"
          document.getElementById("log").style.backgroundColor = '#4361ee'
        }, 2000)
      }
    });
  })



</script>

</html>