<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />

    <title>Lake of Cakes | Send Email</title>

    <link href="../../assets/css/plugin.css" rel="stylesheet" />
    <link href="../../assets/css/jquery.tagit.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../assets/css/bootstrap-coloroicker.css" />
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="../../assets/plugins/fontawesome-free/css/all.min.css"
    />
    <link rel="stylesheet" href="../../assets/css/adminlte.min.css" />
    <link href="../../assets/css/style.css" rel="stylesheet" />
    <link href="../../assets/css/custom.css" rel="stylesheet" />
    <link href="../../assets/css/responsive.css" rel="stylesheet" />
    <link href="../../assets/css//Common.css" rel="stylesheet" />
    <!-- <link href="../../assets/css/product.css" rel="stylesheet" /> -->
    <link href="../../assets/css/jquery.Jcrop.css" rel="stylesheet" />
    <link href="../../assets/css/Jcrop-style.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="../../assets/plugins/summernote/summernote-bs4.css"
    />
  </head>

  <body
    class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed"
  >
    <section id="admin-nav-load"></section>
    <section class="wrapper">
      <div class="content-wrapper">
        <div class="container-fluid">
          <input
            type="hidden"
            name="_token"
            value="DXWvm5qE4JiU2PfjqXiBb5G9IqfhCioRs3YkjfNk"
          />
          <div class="row">
            <div class="col-lg-12">
              <div
                class="add-product-content"
                style="background-color: rgba(213, 214, 169, 0.3)"
              >
                <div class="row">
                  <div class="col-lg-12">
                    <div class="product-description">
                      <div class="body-area">
                        <h3>
                          Send Email To (Dont use this feature now - Fixing some
                          issues)
                        </h3>
                        <div class="row">
                          <div class="col-lg-12">
                            <h4 class="MainHeading">
                              Create a personalized email
                            </h4>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-12">
                            <div class="left-area">
                              <h4 class="heading">Email Subject</h4>
                            </div>
                          </div>
                          <div class="col-lg-12">
                            <input
                              type="text"
                              class="input-field"
                              placeholder="Ex: New Year Offers  "
                              id="subject"
                              required
                            />
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-12">
                            <div
                              class="panel panel-body"
                              style="background-color: gray"
                            >
                              <!-- <textarea
                                class="textarea1"
                                placeholder="Place some text here"
                                style="
                                  width: 100%;
                                  height: 400px;
                                  font-size: 34px;
                                  line-height: 28px;
                                  border: 1px solid #dddddd;
                                  padding: 10px;
                                "
                              ></textarea> -->
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <input
                            type="file"
                            name="subImgs"
                            class="hidden"
                            id="subImgs"
                            accept="image/*"
                            multiple
                          />
                          <br />
                          <div class="row mb-4">
                            <div class="col-lg-12 mb-4">
                              <div class="left-area">
                                <h4 class="mainHeading">Email Images</h4>
                              </div>
                            </div>
                            <div class="col-lg-12" style="padding: 20px">
                              <div
                                class="modal-body"
                                style="border: 1px solid black; padding: 10px"
                              >
                                <div class="top-area">
                                  <div class="row">
                                    <div class="col-sm-6 text-right">
                                      <div
                                        class="upload-img-btn"
                                        style="cursor: pointer"
                                      >
                                        <label
                                          for="image-upload"
                                          id="prod_gallery"
                                          style="cursor: pointer"
                                          ><i class="fas fa-upload"></i>Upload
                                          File</label
                                        >
                                      </div>
                                    </div>
                                    <div class="col-sm-6">
                                      <a
                                        href="javascript:;"
                                        class="upload-done"
                                        data-dismiss="modal"
                                      >
                                        <i class="fas fa-check"></i> Done</a
                                      >
                                    </div>
                                    <div class="col-sm-12 text-center">
                                      (
                                      <small
                                        >You can upload multiple images at
                                        once.</small
                                      >
                                      )
                                    </div>
                                  </div>
                                </div>
                                <div class="gallery-images">
                                  <div class="selected-image">
                                    <div class="row"></div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-lg-12 text-center">
                            <button
                              class="addProductSubmit-btn"
                              type="submit"
                              onclick="getData()"
                            >
                              Push Email
                            </button>
                            <progress value="0" max="100" id="uploader">
                              0%
                            </progress>
                            <p id="demo"></p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br />
        </div>
      </div>
    </section>
    <section id="admin-footer-load"></section>

    <script src="../../assets/plugins/jquery/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../../assets/js/jqueryui.min.js"></script>
    <script src="../../assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/adminlte.min.js"></script>
    <script type="text/javascript">
      $("#admin-nav-load").load("/Common/navbar.html");
      $("#admin-footer-load").load("/Common/footer.html");
    </script>
    <script src="../../assets/plugins/summernote/summernote-bs4.min.js"></script>

    <script src="../../assets/js/demo.js"></script>
    <!-- <script src="../../assets/js/bootstrap.min.js"></script> -->

    <!-- <script src="../../assets/js/popper.js"></script>
   -->

    <script>
      // Tags
    </script>

    <script></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-functions.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyATUjzcsSQMIKlEeBQqMGTy_4zugRTPILg",
        authDomain: "lake-of-cakes.firebaseapp.com",
        databaseURL: "https://lake-of-cakes.firebaseio.com",
        projectId: "lake-of-cakes",
        storageBucket: "lake-of-cakes.appspot.com",
        messagingSenderId: "779843608951",
        appId: "1:779843608951:web:48c6afe1773e2b395e8172",
        measurementId: "G-5ER0QF0FDW",
      };
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
      let productSubImgs = [];

      const uploadSubImgs = (e) => {
        subImgs = e.target.files;
        // console.log(subImgs);
      };
      subImgs.addEventListener("change", uploadSubImgs);

      $(document).on("click", ".remove-img", function () {
        var id = $(this).find("input[type=hidden]").val();
        $("#galval" + id).remove();
        $(this).parent().parent().remove();
      });

      $(document).on("click", "#prod_gallery", function () {
        $("#subImgs").click();
        $(".selected-image .row").html("");
        $("#add-product").find(".removegal").val(0);
      });
      var arr = [];
      $("#subImgs").change(function () {
        var total_file = document.getElementById("subImgs").files.length;
        for (var i = 0; i < total_file; i++) {
          arr.push(event.target.files[i]);
          $(".selected-image .row").append(
            '<div class="col-sm-6">' +
              '<div class="img gallery-img" style="width:100px;object-fit:cover">' +
              '<span class="remove-img"><i class="fas fa-times"></i>' +
              '<input type="hidden" value="' +
              i +
              '">' +
              "</span>" +
              '<a href="' +
              URL.createObjectURL(event.target.files[i]) +
              '" target="_blank">' +
              '<img src="' +
              URL.createObjectURL(event.target.files[i]) +
              '" alt="gallery image" style="width:300px;object-fit:cover">' +
              "</a>" +
              "</div>" +
              "</div> "
          );

          // $("#add-product").append(
          //   '<input type="hidden" name="galval[]" id="galval' +
          //     i +
          //     '" class="removegal" value="' +
          //     i +
          //     '">'
          // );
        }
      });
      let db = firebase.firestore();
      // $(function () {
      //   $(".textarea1").summernote();
      // });
      var uploader = document.getElementById("uploader");
      var counti=0;
      async function getData() {
        let subject = document.querySelector("#subject").value;

        if (subject) {
          let ans = confirm("Are you sure to send the email");
          if (ans) {
            for (let img of subImgs) {
              // let template = $(".textarea1").summernote("code");
              alert(img.name)
              const storageService = firebase.storage();
              var uploadTask = storageService
                .ref("EmailNotification/" + img.name)
                .put(img);

              // console.log(selectedFile.getDownloadURL);
              await uploadTask.on(
                "state_changed",
                function (snapshot) {
                  var percentage =
                    (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                  uploader.value = percentage;

                  // Observe state change events such as progress, pause, and resume
                  // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                  progress =
                    (snapshot.bytesTransferred / snapshot.totalBytes) * 100;

                  document.getElementById("demo").innerHTML = progress;
                  switch (snapshot.state) {
                    case firebase.storage.TaskState.PAUSED: // or 'paused'
                      document.getElementById("demo").innerHTML =
                        "Upload Paused";
                      console.log("Upload is paused");
                      break;
                    case firebase.storage.TaskState.RUNNING: // or 'running'
                      document.getElementById("demo").innerHTML =
                        "File is uploading" + " " + progress + "%";

                      break;
                  }
                },
                function (error) {
                  console.log(error);
                  // Handle unsuccessful uploads
                },
                async function () {
                  document.getElementById("demo").innerHTML =
                    "Uploaded" + " " + progress + "%";
                  // Handle successful uploads on complete
                  // For instance, get the download URL: https://firebasestorage.googleapis.com/...
                  await uploadTask.snapshot.ref
                    .getDownloadURL()
                    .then(function (downloadURL) {
                      counti++;
                      // console.log("File available at", downloadURL);
                      urls = downloadURL;
                      console.log(urls)
                    });
                }
              );
            }
            // db.collection("email-Notifications")
            //             .add({
            //               url: urls,
            //               status: "pending",
            //               subject: subject,
            //               createdAt: new Date(),
            //             })
            //             .then(function () {
            //              alert(subImgs.length +"-"+counti)
            //               // alert("Email Sent Successfully");
            //             });
          }
        } else {
          alert("Subject is Required");
        }
      }
    </script>
  </body>
</html>
